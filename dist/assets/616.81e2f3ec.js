(()=>{"use strict";var e,t,s={4908:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WebEnv=t.wrapFile=void 0;const a=s(9557);t.wrapFile=e=>({name:e.name,size:e.size,lastModified:e.lastModified,slice:(t,s)=>void 0!==t?e.slice(t,s).arrayBuffer():e.arrayBuffer()});const i=new a.Progress;t.WebEnv={loadAsset:async(e,t)=>(i.new("Downloading file",e.split("/").pop()),new Promise(((s,a)=>{const n=new XMLHttpRequest;n.responseType=t,n.open("GET",e),n.onload=()=>{i.success(),200===n.status?s(n.response):a(n.statusText)},n.onerror=()=>a("XHR Error, check your internet connection"),n.onprogress=e=>i.progress("bytes",e.loaded||0,e.total<=0?void 0:e.total),n.send()}))),progress:i}},5616:(e,t,s)=>{const a=s(4908),i=s(4280);self.onmessage=async e=>{const{progress:t}=a.WebEnv;t.on("progress",((e,t)=>self.postMessage({type:"progress",tasks:e,stats:t})));try{const t=await(0,i.generateDatabase)(e.data.files.map(a.wrapFile),e.data.config,a.WebEnv),s={type:"result",data:"",html:(await(0,i.generateReport)(t,a.WebEnv)).html,title:t.title,lang:t.langs.length>0?t.langs[0]:"",counts:{messages:t.numMessages,authors:t.authors.length,channels:t.channels.length,guilds:t.guilds.length}};self.postMessage(s)}catch(e){e instanceof Error?t.error(e.message):t.error(e+""),console.log("Error ahead â†“"),console.error(e)}},console.log("WorkerApp started")},4566:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.getAttachmentTypeFromMimeType=t.getAttachmentTypeFromFileName=t.AttachmentType=void 0,function(e){e[e.Image=0]="Image",e[e.ImageAnimated=1]="ImageAnimated",e[e.Video=2]="Video",e[e.Sticker=3]="Sticker",e[e.Audio=4]="Audio",e[e.Document=5]="Document",e[e.Other=6]="Other"}(s=t.AttachmentType||(t.AttachmentType={}));const a={[s.Image]:["png","jpg","jpeg","webp","bmp","tiff","tif","svg","ico","psd"],[s.ImageAnimated]:["gif","gifv","apng"],[s.Video]:["mp4","webm","mkv","flv","mov","avi","wmv","mpg","mpeg","avi"],[s.Audio]:["mp3","ogg","wav","flac","m4a"],[s.Document]:["doc","docx","odt","pdf","xls","xlsx","ods","ppt","pptx","txt","html"]},i=["application/pdf","application/epub","application/epub+zip","text/html","application/rtf","application/msword","application/vnd.oasis.opendocument.spreadsheet","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/plain"];t.getAttachmentTypeFromFileName=e=>{const t=(e.split(".").pop()||"").toLowerCase();for(let e=0;e<=s.Other;e++)if(a[e]?.includes(t))return e;return s.Other},t.getAttachmentTypeFromMimeType=e=>(e=e.toLowerCase()).startsWith("image/gif")?s.ImageAnimated:e.startsWith("image/")?s.Image:e.startsWith("video/")?s.Video:e.startsWith("audio/")?s.Audio:i.includes(e)?s.Document:s.Other},4451:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LanguageNames=t.getLanguageIndexByCode=t.LanguageCodes=void 0,t.LanguageCodes=["","af","als","am","an","ar","arz","as","ast","av","az","azb","ba","bar","bcl","be","bg","bh","bn","bo","bpy","br","bs","bxr","ca","cbk","ce","ceb","ckb","co","cs","cv","cy","da","de","diq","dsb","dty","dv","el","eml","en","eo","es","et","eu","fa","fi","fr","frr","fy","ga","gd","gl","gn","gom","gu","gv","he","hi","hif","hr","hsb","ht","hu","hy","ia","id","ie","ilo","io","is","it","ja","jbo","jv","ka","kk","km","kn","ko","krc","ku","kv","kw","ky","la","lb","lez","li","lmo","lo","lrc","lt","lv","mai","mg","mhr","min","mk","ml","mn","mr","mrj","ms","mt","mwl","my","myv","mzn","nah","nap","nds","ne","new","nl","nn","no","oc","or","os","pa","pam","pfl","pl","pms","pnb","ps","pt","qu","rm","ro","ru","rue","sa","sah","sc","scn","sco","sd","sh","si","sk","sl","so","sq","sr","su","sv","sw","ta","te","tg","th","tk","tl","tr","tt","tyv","ug","uk","ur","uz","vec","vep","vi","vls","vo","wa","war","wuu","xal","xmf","yi","yo","yue","zh"],t.getLanguageIndexByCode=e=>t.LanguageCodes.indexOf(e),t.LanguageNames=["Unreliable to detect","Afrikaans","Alemannic","Amharic","Aragonese","Arabic","Egyptian Arabic","Assamese","Asturian","Avaric","Azerbaijani","South Azerbaijani","Bashkir","Bavarian","Central Bikol","Belarusian","Bulgarian","Bihari","Bengali","Tibetan","Bishnupriya","Breton","Bosnian","Russia Buriat","Catalan","Chavacano","Chechen","Cebuano","Central Kurdish","Corsican","Czech","Chuvash","Welsh","Danish","German","Dimli (individual language)","Lower Sorbian","Dotyali","Dhivehi","Modern Greek (1453-)","Emilian-Romagnol","English","Esperanto","Spanish","Estonian","Basque","Persian","Finnish","French","Northern Frisian","Western Frisian","Irish","Scottish Gaelic","Galician","Guarani","Goan Konkani","Gujarati","Manx","Hebrew","Hindi","Fiji Hindi","Croatian","Upper Sorbian","Haitian","Hungarian","Armenian","Interlingua (International Auxiliary Language Association)","Indonesian","Interlingue","Iloko","Ido","Icelandic","Italian","Japanese","Lojban","Javanese","Georgian","Kazakh","Khmer","Kannada","Korean","Karachay-Balkar","Kurdish","Komi","Cornish","Kirghiz","Latin","Luxembourgish","Lezghian","Limburgan","Lombard","Lao","Northern Luri","Lithuanian","Latvian","Maithili","Malagasy","Eastern Mari","Minangkabau","Macedonian","Malayalam","Mongolian","Marathi","Western Mari","Malay","Maltese","Mirandese","Burmese","Erzya","Mazanderani","Nahuatl","Neapolitan","Low German","Nepali","Newari","Dutch","Norwegian Nynorsk","Norwegian","Occitan (post 1500)","Oriya","Ossetian","Panjabi","Pampanga","Pfaelzisch","Polish","Piemontese","Western Panjabi","Pushto","Portuguese","Quechua","Romansh","Romanian","Russian","Rusyn","Sanskrit","Yakut","Sardinian","Sicilian","Scots","Sindhi","Serbo-Croatian","Sinhala","Slovak","Slovenian","Somali","Albanian","Serbian","Sundanese","Swedish","Swahili","Tamil","Telugu","Tajik","Thai","Turkmen","Tagalog","Turkish","Tatar","Tuvinian","Uighur","Ukrainian","Urdu","Uzbek","Venetian","Veps","Vietnamese","Vlaams","VolapÃ¼k","Walloon","Waray (Philippines)","Wu Chinese","Kalmyk","Mingrelian","Yiddish","Yoruba","Yue Chinese","Chinese"]},9557:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Progress=void 0;const a=s(7007);class i extends a.EventEmitter{constructor(){super(...arguments),this.tasks=[],this.keys={},this.errored=!1,this.lastCount=0,this.lastTs=0}new(e,t){if(this.errored)throw new Error("Can't create new progress task after an error");const s={status:"processing",title:e,subject:t};this.active&&(this.active.status="waiting"),this.active=s,this.tasks.push(s),this.update(!0)}progress(e,t,s){if(!this.active){const e=this.tasks.slice().reverse().find((e=>"waiting"===e.status));if(e){const t=JSON.parse(JSON.stringify(e));t.status="processing",this.tasks.push(t),this.active=t}}if(!this.active)throw new Error("No active task to update progress");this.active.progress={actual:t,total:s,format:e},this.update(!1)}success(){if(!this.active)throw new Error("No active task to mark as success");this.active.status="success",this.active.progress&&this.active.progress.total&&(this.active.progress.actual=this.active.progress.total),this.active=void 0,this.update(!0)}error(e){this.active||this.new("Error"),this.active.status="error",this.active.error=e,this.errored=!0,this.update(!0)}stat(e,t){if(this.keys[e]!==t){const s=e in this.keys;this.keys[e]=t,this.update(!s)}}update(e){let t=e,s=0;if(!t&&this.active&&this.active.progress){if(void 0!==this.active.progress.total){const e=.01*this.active.progress.total;t=this.active.progress.actual-this.lastCount>=e}t||(s=Date.now(),t=s-this.lastTs>15)}t&&(this.emit("progress",this.tasks,this.keys),this.lastCount=this.active?.progress?.actual||0,this.lastTs=s||Date.now())}}t.Progress=i},1739:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.formatDatetime=t.formatTime=t.genTimeKeys=t.Day=void 0;class s{constructor(e,t,s){this.year=e,this.month=t,this.day=s}static fromDate(e){return new s(e.getFullYear(),e.getMonth()+1,e.getDate())}static fromKey(e){const t=e.split("-").map(Number);switch(t.length){case 1:return new s(t[0],1,1);case 2:return new s(t[0],t[1],1);case 3:return new s(t[0],t[1],t[2]);default:return new s(t[0],t[1],7*t[3]+1)}}static fromBinary(e){return new s(e>>>9,e>>>5&15,31&e)}toDate(){return new Date(this.year,this.month-1,this.day)}toBinary(){return this.year<<9|this.month<<5|this.day}toTimestamp(){return this.toDate().getTime()}get yearKey(){return`${this.year}`}get monthKey(){return`${this.year}-${this.month}`}get weekKey(){const e=Math.floor((this.day-1)/7);return`${this.year}-${this.month}--${e}`}get dateKey(){return`${this.monthKey}-${this.day}`}nextDays(e){const t=this.toDate();return t.setDate(t.getDate()+e),s.fromDate(t)}nextDay(){return this.nextDays(1)}static eq(e,t){return e.year===t.year&&e.month===t.month&&e.day===t.day}static lt(e,t){return e.year<t.year||e.year===t.year&&e.month<t.month||e.year===t.year&&e.month===t.month&&e.day<t.day}static gt(e,t){return e.year>t.year||e.year===t.year&&e.month>t.month||e.year===t.year&&e.month===t.month&&e.day>t.day}static min(e,t){return s.lt(e,t)?e:t}static max(e,t){return s.gt(e,t)?e:t}static clamp(e,t,a){return s.min(s.max(e,t),a)}}t.Day=s,s.LOWEST=new s(0,0,0),s.HIGHEST=new s(9999,12,31),t.genTimeKeys=(e,t)=>{if(s.lt(t,e))throw new Error("genTimeKeys: start must be before end");const a=t.nextDay(),i=[],n=[],r=[],o=[],d=[],h=[],l=[];let c=e;for(;!s.eq(c,a);){const e=c.dateKey,t=c.monthKey,s=c.weekKey,a=c.yearKey;0!==n.length&&n[n.length-1]===s||n.push(s),0!==r.length&&r[r.length-1]===t||r.push(t),0!==o.length&&o[o.length-1]===a||o.push(a),i.push(e),d.push(n.length-1),h.push(r.length-1),l.push(o.length-1),c=c.nextDay()}return{dateKeys:i,weekKeys:n,monthKeys:r,yearKeys:o,dateToMonthIndex:h,dateToWeekIndex:d,dateToYearIndex:l}};const a="numeric",i="long",n="2-digit",r="2-digit",o="2-digit",d={y:new Intl.DateTimeFormat(void 0,{year:a}),ym:new Intl.DateTimeFormat(void 0,{year:a,month:i}),ymd:new Intl.DateTimeFormat(void 0,{year:a,month:i,day:n}),ymdh:new Intl.DateTimeFormat(void 0,{year:a,month:i,day:n,hour:r}),symd:new Intl.DateTimeFormat(void 0,{year:"numeric",month:"numeric",day:"numeric"}),ymdhm:new Intl.DateTimeFormat(void 0,{year:a,month:i,day:n,hour:r,minute:o}),ymdhms:new Intl.DateTimeFormat(void 0,{year:a,month:i,day:n,hour:r,minute:o,second:"2-digit"})};t.formatTime=(e,t,s=0)=>{const a=t.toDate();return a.setSeconds(s),d[e].format(a)},t.formatDatetime=(e,a)=>void 0===a?"-":(0,t.formatTime)(e,s.fromKey(a.key),a.secondOfDay)},3418:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.base91decode=t.base91encode=void 0;const s='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!#$%&()*+,./:;-=>?@[]^_`{|}~"'.split("").map((e=>e.charCodeAt(0))),a=s.reduce(((e,t,s)=>(e[t]=s,e)),new Uint8Array(256));t.base91encode=e=>{const t=e.length;let a=0,i=0,n=0,r=0;for(;a<t;){if(n|=e[a]<<i,i+=8,i>13){let e=8191&n;e>88?(n>>=13,i-=13):(e=16383&n,n>>=14,i-=14),r+=2}a++}i&&(r++,(i>7||n>90)&&r++);const o=new Uint8Array(12+r);let d=12;a=0,i=0,n=0;const h=t.toString().padStart(12,"0");for(o.set((new TextEncoder).encode(h),0);a<t;){if(n|=e[a]<<i,i+=8,i>13){let e=8191&n;e>88?(n>>=13,i-=13):(e=16383&n,n>>=14,i-=14),o[d++]=s[e%91],o[d++]=s[e/91|0]}a++}return i&&(o[d++]=s[n%91],(i>7||n>90)&&(o[d++]=s[n/91|0])),new TextDecoder("iso-8859-10").decode(o)},t.base91decode=e=>{let t=12,s=0,i=0,n=0,r=-1;const o=e.length,d=parseInt(e.slice(0,12)),h=new Uint8Array(d);for(;t<o;){const o=a[e[t].charCodeAt(0)];if(r<0)r=o;else{r+=91*o,i|=r<<n,n+=(8191&r)>88?13:14;do{h[s++]=255&i,i>>=8,n-=8}while(n>7);r=-1}t++}return r>-1&&(h[s++]=255&(i|r<<n)),h}},4239:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.decompressDatabase=t.compressDatabase=void 0;const a=s(4419),i=s(3418);t.compressDatabase=e=>{let t=e.messages,s=JSON.stringify({...e,messages:void 0}),n=(new TextEncoder).encode(s);s=void 0;let r=new Uint8Array(8+n.byteLength+t.byteLength),o=new DataView(r.buffer);o.setUint32(0,n.length),o.setUint32(4,t.byteLength),r.set(n,8),r.set(t,8+n.length),n=void 0;let d=(0,a.gzipSync)(r);r=void 0;let h=(0,i.base91encode)(d);return d=void 0,h},t.decompressDatabase=e=>{const t=(0,i.base91decode)(e),s=(0,a.gunzipSync)(t),n=new DataView(s.buffer),r=n.getUint32(0),o=n.getUint32(4),d=s.slice(8,8+r),h=s.slice(8+r,8+r+o),l=(new TextDecoder).decode(d),c=JSON.parse(l);return c.messages=h,c}},4280:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generateReport=t.generateDatabase=void 0;const a=s(4239),i=s(3230);t.generateDatabase=async(e,t,s)=>{const a=new i.DatabaseBuilder(t,s);return await a.init(),await a.processFiles(e),a.build()},t.generateReport=async(e,t)=>{t.progress?.new("Compressing");const s=(0,a.compressDatabase)(e);t.progress?.success();const i=e.title.replace(/</g,"&lt;").replace(/>/g,"&gt;");let n=await t.loadAsset("/report.html","text");n=n.replace("[[TITLE]]",`${i} - Chat Analytics`);const r=n.indexOf("[[[DATA]]]");return{data:s,html:n.slice(0,r)+s+n.slice(r+10)}}},9796:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tryToFindTimestampAtEnd=t.streamJSONFromFile=t.wrapStringAsFile=void 0,t.wrapStringAsFile=e=>{const t=(new TextEncoder).encode(e);return{name:"file"+e.length,size:e.length,lastModified:Date.now(),slice:async(e,s)=>t.slice(e,s)}},t.streamJSONFromFile=async function*(e,t,s){const a=t.size,i=new TextDecoder("utf-8");let n=0;for(;n<a;){const r=await t.slice(n,n+2097152),o=i.decode(r,{stream:!0});n+=r.byteLength,e.push(o),s?.progress("bytes",n,a),yield}},t.tryToFindTimestampAtEnd=async(e,t)=>{const s=await t.slice(Math.max(0,t.size-4096),t.size),a=(new TextDecoder).decode(s),i=Array.from(a.matchAll(e)).pop();if(i&&i.length>=2){const e=i[1];let t;if(t=e.includes("T")?new Date(e).getTime():parseInt(e,10),!isNaN(t))return t}}},784:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.JSONStream=void 0;var s;!function(e){e[e.INVALID=0]="INVALID",e[e.ROOT=1]="ROOT",e[e.NEXT_KEY=2]="NEXT_KEY",e[e.NEXT_ARRAY_ITEM=3]="NEXT_ARRAY_ITEM",e[e.START_ARRAY=4]="START_ARRAY",e[e.END_ARRAY=5]="END_ARRAY",e[e.VALUE=6]="VALUE",e[e.END_VALUE_KEY=7]="END_VALUE_KEY",e[e.END_VALUE_ROOT=8]="END_VALUE_ROOT",e[e.END_VALUE_ARRAY=9]="END_VALUE_ARRAY"}(s||(s={}));const a=e=>44===e||125===e||93===e,i=e=>13===e||10===e||32===e||9===e;t.JSONStream=class{constructor(){this.objectCallbacks={},this.arrayCallbacks={},this.state=s.ROOT,this.next=s.INVALID,this.index=0,this.buffer="",this.valueStart=0,this.valueEnd=0,this.slashed=!1,this.quotes=!1,this.brackets=0,this.braces=0,this.primitive=!0}parseValue(){return JSON.parse(this.buffer.slice(this.valueStart,this.valueEnd+1))}push(e){if(this.buffer+=e,0===this.buffer.length)return;let t=this.index,n=this.buffer.charCodeAt(t);for(;n>0;){switch(this.state){case s.ROOT:if(123===n)this.state=s.NEXT_KEY;else if(!i(n))throw new Error("Expected {");break;case s.NEXT_KEY:if(34===n||44===n){if(this.state=s.VALUE,this.next=s.END_VALUE_KEY,34===n){this.valueStart=this.valueEnd=t;continue}this.valueStart=this.valueEnd=t+1}else if(125===n)this.state=s.ROOT;else if(!i(n))throw new Error('Expected ", comma or }');break;case s.NEXT_ARRAY_ITEM:if(44===n)this.valueStart=this.valueEnd=t+1,this.state=s.VALUE,this.next=s.END_VALUE_ARRAY;else{if(93===n){this.state=s.END_ARRAY,this.next=s.INVALID;continue}if(!i(n))throw new Error("Expected , or ]")}break;case s.START_ARRAY:if(91===n)this.valueStart=this.valueEnd=t+1,this.state=s.VALUE,this.next=s.END_VALUE_ARRAY;else if(!i(n))throw new Error("Expected [");break;case s.END_ARRAY:if(93===n)this.state=s.NEXT_KEY;else if(!i(n))throw new Error("Expected ]");break;case s.VALUE:if(0===this.brackets&&0===this.braces&&!1===this.quotes&&this.primitive&&a(n)){this.state=this.next,this.next=s.INVALID;continue}if(this.valueEnd=t,i(n))break;if(92===n){this.slashed=!this.slashed;break}if(34===n){if(this.primitive=!1,this.slashed){this.slashed=!1;break}this.quotes=!this.quotes}if(this.slashed=!1,this.quotes)break;91===n?this.brackets++:123===n?this.braces++:93===n?this.brackets--:125===n&&this.braces--;const e=0===this.brackets&&0===this.braces;this.primitive=this.primitive&&e,!this.primitive&&e&&(this.primitive=!0,this.state=this.next,this.next=s.INVALID);break;case s.END_VALUE_ROOT:this.key in this.objectCallbacks&&this.objectCallbacks[this.key](this.parseValue()),this.state=s.NEXT_KEY;continue;case s.END_VALUE_KEY:if(58===n){if(this.key=this.parseValue(),"string"!=typeof this.key)throw new Error("Expected string on key");this.key in this.arrayCallbacks?(this.state=s.START_ARRAY,this.next=s.INVALID):(this.valueStart=this.valueEnd=t+1,this.state=s.VALUE,this.next=s.END_VALUE_ROOT)}else if(!i(n))throw new Error("Expected :");break;case s.END_VALUE_ARRAY:this.arrayCallbacks[this.key](this.parseValue()),this.state=s.NEXT_ARRAY_ITEM;continue;default:throw new Error("Invalid JSON state: "+this.state)}t++,n=this.buffer.charCodeAt(t)}const r=Math.min(t,this.valueStart);this.buffer=this.buffer.slice(r),this.index=t-r,this.valueEnd-=r,this.valueStart-=r}onObject(e,t){return this.objectCallbacks[e]=t,this}onArrayItem(e,t){return this.arrayCallbacks[e]=t,this}}},9341:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;const a=s(7007);class i extends a.EventEmitter{}t.Parser=i},7040:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createParser=void 0;const a=s(9108),i=s(5899),n=s(4591),r=s(650);t.createParser=e=>{let t=null;switch(e){case"discord":t=new a.DiscordParser;break;case"messenger":t=new i.MessengerParser;break;case"whatsapp":t=new r.WhatsAppParser;break;case"telegram":t=new n.TelegramParser}return t}},9108:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DiscordParser=void 0;const a=s(4566),i=s(9796),n=s(784),r=s(9341);class o extends r.Parser{async*parse(e,t){this.lastMessageTimestampInFile=await(0,i.tryToFindTimestampAtEnd)(o.TS_MSG_REGEX,e);const s=(new n.JSONStream).onObject("guild",this.parseGuild.bind(this)).onObject("channel",this.parseChannel.bind(this)).onArrayItem("messages",this.parseMessage.bind(this));yield*(0,i.streamJSONFromFile)(s,e,t)}parseGuild(e){let t=e.iconUrl;"https://cdn.discordapp.com/embed/avatars/0.png"===t&&(t=void 0),this.emit("guild",{id:e.id,name:e.name,avatar:t},this.lastMessageTimestampInFile),this.lastGuildId=e.id}parseChannel(e){if(void 0===this.lastGuildId)throw new Error("Missing guild ID");let t="text";"DirectTextChat"==e.type?t="dm":"DirectGroupTextChat"==e.type&&(t="group");const s={id:e.id,guildId:this.lastGuildId,name:e.name,type:t,avatar:"group"===t?this.parseSnowflake(e.id).timestamp.toString():void 0};this.emit("channel",s,this.lastMessageTimestampInFile),this.lastChannelId=e.id}parseMessage(e){if(void 0===this.lastChannelId)throw new Error("Missing channel ID");const t=Date.parse(e.timestamp),s=e.timestampEdited?Date.parse(e.timestampEdited):void 0,i=e.author.nickname||e.author.name,n="Deleted User"===i;let r;e.author.avatarUrl&&e.author.avatarUrl.includes("discordapp.com/avatars")&&(r=e.author.avatarUrl.slice(35).split(".")[0]);const o={id:e.author.id,bot:e.author.isBot,name:i+(n?" #"+e.author.id:"#"+e.author.discriminator),avatar:r?(" "+r).substring(1):void 0};if(this.emit("author",o,this.lastMessageTimestampInFile),"Default"==e.type||"Reply"==e.type){let i=e.content;for(const t of e.mentions)i=i.split(`@${t.name}`).join(` @${t.nickname.replace(/\s/g,"_")} `);const n=e.stickers||[],r={id:e.id,authorId:e.author.id,channelId:this.lastChannelId,timestamp:t,timestampEdit:s,replyTo:e.reference?.messageId,textContent:i.length>0?i:void 0,attachments:e.attachments.map((e=>(0,a.getAttachmentTypeFromFileName)(e.fileName))).concat(n.map((e=>a.AttachmentType.Sticker))),reactions:e.reactions.map((e=>{const t=null===e.emoji.id||""===e.emoji.id?void 0:e.emoji.id;return[{id:t,text:e.emoji.name||t||"unknown"},e.count]}))};this.emit("message",r,this.lastMessageTimestampInFile)}}parseSnowflake(e){return{timestamp:BigInt(e)>>BigInt(22)}}}t.DiscordParser=o,o.TS_MSG_REGEX=/"timestamp": ?"([0-9-:.+T]+)"/gi},5899:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessengerParser=void 0;const a=s(4566),i=s(9341);class n extends i.Parser{constructor(){super(...arguments),this.messageIndex=0}async*parse(e){const t=await e.slice(),s=new TextDecoder("utf-8").decode(t),a=JSON.parse(s);this.emit("guild",{id:0,name:"Messenger Chats"}),this.emit("channel",{guildId:0,id:a.thread_path,name:a.title,type:a.participants.length>2?"group":"dm"});for(const e of a.messages.reverse())this.emit("author",{id:e.sender_name,name:e.sender_name,bot:!1}),this.emit("message",{id:this.messageIndex++,timestamp:e.timestamp_ms,authorId:e.sender_name,channelId:a.thread_path,textContent:e.content,attachments:this.parseAttachments(e)}),yield}parseAttachments(e){const t=[];if(e.photos)for(const s of e.photos)t.push(a.AttachmentType.Image);if(e.audio_files)for(const s of e.audio_files)t.push(a.AttachmentType.Audio);if(e.files)for(const s of e.files)t.push(a.AttachmentType.Other);return e.sticker&&t.push(a.AttachmentType.Sticker),t}}t.MessengerParser=n},4591:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TelegramParser=void 0;const a=s(4566),i=s(9796),n=s(784),r=s(9341);class o extends r.Parser{async*parse(e,t){this.lastMessageTimestampInFile=await(0,i.tryToFindTimestampAtEnd)(o.TS_MSG_REGEX,e);const s=(new n.JSONStream).onObject("name",this.onChannelName.bind(this)).onObject("type",this.onChannelType.bind(this)).onObject("id",this.onChannelId.bind(this)).onArrayItem("messages",this.parseMessage.bind(this));yield*(0,i.streamJSONFromFile)(s,e,t),this.lastChannelName=void 0,this.lastChannelID=void 0}onChannelName(e){this.lastChannelName=e}onChannelType(e){this.lastChannelType=e}onChannelId(e){this.lastChannelID=e;const t={id:e,guildId:0,name:this.lastChannelName||"Telegram chat",type:["personal_chat","bot_chat"].includes(this.lastChannelType||"")?"dm":"group"};this.emit("guild",{id:0,name:"Telegram Chats"},this.lastMessageTimestampInFile),this.emit("channel",t,this.lastMessageTimestampInFile)}parseMessage(e){if(void 0===this.lastChannelID)throw new Error("Missing channel ID");const t=e.id+"",s=e.from_id+"",i=null===e.reply_to_message_id?void 0:e.reply_to_message_id+"",n=Date.parse(e.date),r=e.edited?Date.parse(e.edited):void 0;if("message"===e.type){const o={id:s,name:e.from||t,bot:!1};this.emit("author",o,this.lastMessageTimestampInFile);let d,h=this.parseTextArray(e.text);"sticker"===e.media_type&&(d=a.AttachmentType.Sticker),e.mime_type&&(d=(0,a.getAttachmentTypeFromMimeType)(e.mime_type)),void 0!==e.location_information&&(d=a.AttachmentType.Other),0===h.length&&void 0===d&&(e.photo&&(d=a.AttachmentType.Image),e.poll&&(h=e.poll.question));const l={id:t,replyTo:i,authorId:s,channelId:this.lastChannelID,timestamp:n,timestampEdit:r,textContent:h,attachments:void 0===d?[]:[d]};this.emit("message",l,this.lastMessageTimestampInFile)}}parseTextArray(e){if("string"==typeof e)return e;if(Array.isArray(e))return e.map(this.parseTextArray.bind(this)).join("");switch(e.type){case"bot_command":return e.text.replace("/","").replace("@"," @");case"hashtag":return e.text.replace("#","");case"link":case"mention":case"text_link":return` ${e.text} `;case"email":return"";default:return e.text}}}t.TelegramParser=o,o.TS_MSG_REGEX=/"date_unixtime": ?"([0-9]+)"/gi},9173:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.matchAttachmentType=t.isGroupWelcome=t.removeBadChars=t.extractChatName=void 0;const a=s(4566),i=s(5932),n=["WhatsApp Chat - ","WhatsApp Chat with ","Chat de WhatsApp con ","Ğ§Ğ°Ñ‚ WhatsApp Ñ ","Chat WhatsApp con ","Conversa no WhatsApp com ","Conversa do WhatsApp com ","WhatsApp Chat mit ","Discussion WhatsApp avec "];n.push(...n.map((e=>e.replace(/ /g,"_")))),t.extractChatName=e=>{let t;for(const s of n)if((0,i.matchFormat)(e).startsWith((0,i.matchFormat)(s))&&(e.endsWith(".txt")||e.endsWith(".zip"))){t=e.slice(s.length,-4);break}return void 0!==t&&(t=t.replace(/_/g," ").trim()),t},t.removeBadChars=e=>e.replace(/[\u202a\u200e\u202c\xa0]/g,"");const r=["Messages and calls are end-to-end encrypted. No one outside of this chat, not even WhatsApp, can read or listen to them.","Los mensajes y las llamadas estÃ¡n cifrados de extremo a extremo. Nadie fuera de este chat, ni siquiera WhatsApp, puede leerlos ni escucharlos."];t.isGroupWelcome=e=>r.some((t=>e.toLocaleLowerCase().includes(t.toLocaleLowerCase())));const o={af:{media:["<media weggelaat>"]},ar:{media:["<ØªÙ… Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·>","<ØªÙ… Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·>"]},az:{media:["<media buraxÄ±ldÄ±>","<Media Ã§Ä±xarÄ±lmÄ±ÅŸdÄ±r>"]},bg:{media:["<Ğ‘ĞµĞ· Ñ„Ğ°Ğ¹Ğ»>"]},bn:{media:["<à¦®à¦¿à¦¡à¦¿à¦¯à¦¼à¦¾ à¦¬à¦¾à¦¦ à¦¦à§‡à¦“à¦¯à¦¼à¦¾ à¦¹à§Ÿà§‡à¦›à§‡>","<à¦®à¦¿à¦¡à¦¿à¦¯à¦¼à¦¾ à¦¬à¦¾à¦¦ à¦¦à§‡à¦“à§Ÿà¦¾ à¦¹à§Ÿà§‡à¦›à§‡>"]},ca:{media:["<fitxers multimÃ¨dia omesos>","<Mitjans omesos>"]},cs:{media:["<mÃ©dia vynechÃ¡ny>","< MÃ©dia vynechÃ¡na >"]},da:{media:["<medier udeladt>","<Mediefil udeladt>"]},de:{media:["<medien ausgeschlossen>","<Medien weggelassen>"]},el:{media:["<Î±ÏÏ‡ÎµÎ¯Î¿ Ï€Î±ÏÎ±Î»Î®Ï†Î¸Î·ÎºÎµ>","<Î•Î¾Î±Î¯ÏÎµÏƒÎ· Ï€Î¿Î»Ï…Î¼Î­ÏƒÏ‰Î½>"]},en:{media:["<media omitted>"],image:["<image omitted>","image omitted"],video:["<video omitted>","video omitted"],document:["<document omitted>","document omitted"],audio:["<audio omitted>","audio omitted"],GIF:["<GIF omitted>","GIF omitted"],sticker:["<sticker omitted>","sticker omitted"]},es:{media:["<multimedia omitido>","<Archivo omitido>"],image:["<imagen omitida>","imagen omitida"],video:["<video omitido>","video omitido"],document:["<documento omitido>","documento omitido"],audio:["<audio omitido>","audio omitido"],GIF:["<GIF omitido>","GIF omitido"],sticker:["<sticker omitido>","sticker omitido"]},et:{media:["<meedia vÃ¤lja jÃ¤etud>","<Meedia Ã¤ra jÃ¤etud>"]},fa:{media:["<Ø±Ø³Ø§Ù†Ù‡ Ø­Ø°Ù Ø´Ø¯>","< Ù¾ÙŠÙˆØ³Øª Ù†Ù…Ø§/Ø¢Ù‡Ù†Ú¯ Ø­Ø°Ù Ø´Ø¯ >"]},fi:{media:["<media jÃ¤tettiin pois>","<Media jÃ¤tetty pois>"]},fr:{media:["<mÃ©dias omis>","<Fichier omis>"]},gu:{media:["<àª®àª¿àª¡àª¿àª¯àª¾ àª›à«‹àª¡à«€ àª®à«‚àª•àª¾àª¯à«àª‚>","<àª®à«€àª¡àª¿àª¯àª¾ àª…àªµàª—àª£àªµàª¾àª®àª¾àª‚ àª†àªµà«àª¯àª¾>"]},hi:{media:["<à¤®à¥€à¤¡à¤¿à¤¯à¤¾ à¤•à¥‡ à¤¬à¤¿à¤¨à¤¾>"]},hr:{media:["<medijski zapis izostavljen>","<Medijski zapis izostavljen>"]},hu:{media:["<mÃ©dia elhagyva>","<HiÃ¡nyzÃ³ mÃ©diafÃ¡jl>"]},in:{media:["<media tidak disertakan>"]},it:{media:["<media omessi>","<Media omesso>"]},iw:{media:["<×”××“×™×” ×œ× × ×›×œ×œ×”>","<××“×™×” ×”×•×©××˜×”>"]},ja:{media:["<ãƒ¡ãƒ‡ã‚£ã‚¢ãªã—>","<ãƒ¡ãƒ‡ã‚£ã‚¢ã¯å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“>"]},kk:{media:["<Ñ„Ğ°Ğ¹Ğ»Ğ´Ğ°Ñ€ Ò›Ğ¾ÑÑ‹Ğ»Ğ¼Ğ°Ò“Ğ°Ğ½>","<Ğ¤Ğ°Ğ¹Ğ» Ò›Ğ¾ÑÑ‹Ğ»Ò“Ğ°Ğ½ Ğ¶Ğ¾Ò›>"]},kn:{media:["<à²®à²¾à²§à³à²¯à²® à²•à³ˆà²¬à²¿à²¡à²²à²¾à²—à²¿à²¦à³†>"]},ko:{media:["<ë¯¸ë””ì–´ íŒŒì¼ ì œì™¸ë¨>","<ë¯¸ë””ì–´ íŒŒì¼ì„ ìƒëµí•œ ëŒ€í™”ë‚´ìš©>"]},lo:{media:["<àºšà»à»ˆàº¥àº§àº¡àº¡àºµà»€àº”àº>"]},lt:{media:["<medija praleista>","<Praleistas medijos turinys>"]},lv:{media:["<nav iekÄ¼auta multivide>","<Bez multivides>"]},mk:{media:["<Ğ±ĞµĞ· Ñ„Ğ°Ñ˜Ğ»Ğ¾Ğ²Ğ¸>","<Ğ‘ĞµĞ· Ñ„Ğ°Ñ˜Ğ»>"]},ml:{media:["<à´®àµ€à´¡à´¿à´¯ à´’à´´à´¿à´µà´¾à´•àµà´•à´¿>"]},mr:{media:["<à¤®à¥€à¤¡à¤¿à¤¯à¤¾ à¤µà¤—à¤³à¤£à¥à¤¯à¤¾à¤¤ à¤†à¤²à¤¾>","<à¤®à¥€à¤¡à¤¿à¤¯à¤¾ à¤µà¤—à¤³à¤²à¥‡>"]},ms:{media:["<media dikecualikan>","<Media disingkirkan>"]},nb:{media:["<media utelatt>","<Uten vedlegg>"]},nl:{media:["<media weggelaten>","<Media weggelaten>"]},pa:{media:["<à¨®à©€à¨¡à©€à¨† à¨›à©±à¨¡à¨¿à¨†>","<à¨®à©€à¨¡à©€à¨† à¨›à¨¡à¨¿à¨† à¨—à¨¿à¨†>"]},pl:{media:["<pominiÄ™to multimedia>","<pliki pominiÄ™to>"]},pt:{media:["<ficheiro nÃ£o revelado>","<MÃ­dia omitida>"]},ro:{media:["<conÈ›inut media omis>"]},ru:{media:["<Ğ±ĞµĞ· Ğ¼ĞµĞ´Ğ¸Ğ°Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²>","<Ğ¤Ğ°Ğ¹Ğ» Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑ‰ĞµĞ½>"]},sk:{media:["<MÃ©diÃ¡ vynechanÃ©>"]},sl:{media:["<datoteke izpuÅ¡Äene>","<Medij izpuÅ¡Äen>"]},sq:{media:["<media u hoq>","<Media hequr>"]},sr:{media:["<Ğ¼ĞµĞ´Ğ¸Ñ˜Ğ¸ ÑÑƒ Ğ¸Ğ·Ğ¾ÑÑ‚Ğ°Ğ²Ñ™ĞµĞ½Ğ¸>"]},sv:{media:["<media utelÃ¤mnat>","<Media har utelÃ¤mnats>"]},sw:{media:["<media hazijajumuishwa>","<Media imerukwa>"]},ta:{media:["<à®•à¯‹à®ªà¯à®ªà¯à®•à®³à¯ à®µà®¿à®Ÿà®ªà¯à®ªà®Ÿà¯à®Ÿà®©>","< à®Šà®Ÿà®•à®™à¯à®•à®³à¯ à®¨à¯€à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯ >"]},te:{media:["<à°®à±€à°¡à°¿à°¯à°¾ à°µà°¿à°¸à±à°®à°°à°¿à°‚à°šà°¬à°¡à°¿à°‚à°¦à°¿>","<à°®à°¾à°§à±à°¯à°®à°‚ à°µà°¿à°¸à±à°®à°°à°¿à°‚à°šà°¬à°¡à°¿à°‚à°¦à°¿>"]},th:{media:["<à¹„à¸Ÿà¸¥à¹Œà¸ªà¸·à¹ˆà¸­à¸–à¸¹à¸à¸¥à¸š>","<à¸ªà¸·à¹ˆà¸­à¸–à¸¹à¸à¸¥à¸š>"]},tl:{media:["<Ä±nalis ang media>","<Walang kalakip na media>"]},tr:{media:["<medya dahil edilmedi>","<Medya atlanmÄ±ÅŸ>"]},uk:{media:["<Ğ¼ĞµĞ´Ñ–Ğ° Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑ‰ĞµĞ½Ğ¾>"]},ur:{media:["<Ù…ÛŒÚˆÛŒØ§ Ú†Ú¾ÙˆÚ‘ Ø¯ÛŒØ§ Ú¯ÛŒØ§>","<Ù…ÛŒÚˆÛŒØ§ ÛÙ¹Ø§ Ø¯ÛŒØ§ Ú¯ÛŒØ§>"]},uz:{media:["<fayl oâ€˜tkazib yuborildi>"]},vi:{media:["<bá» qua tá»‡p phÆ°Æ¡ng tiá»‡n>","<Bá» qua Media>"]},zh:{media:["<å¿½ç•¥å¤šåª’é«”æª”>","<çœç•¥å¤šåª’ä½“æ–‡ä»¶>"]}},d=e=>e.toLocaleLowerCase().trim(),h=e=>{const t=[];for(const s in o){const a=o[s][e];a&&t.push(...a.map(d))}return t},l={media:h("media"),image:h("image"),video:h("video"),audio:h("audio"),document:h("document"),GIF:h("GIF"),sticker:h("sticker")},c={media:a.AttachmentType.Other,image:a.AttachmentType.Image,video:a.AttachmentType.Video,audio:a.AttachmentType.Audio,document:a.AttachmentType.Document,GIF:a.AttachmentType.ImageAnimated,sticker:a.AttachmentType.Sticker};t.matchAttachmentType=e=>{const t=d(e);let s;for(s in c)for(const e of l[s])if(t.endsWith(e))return c[s]}},650:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WhatsAppParser=void 0;const a=s(4419),i=s(6933),n=s(4566),r=s(9341),o=s(9173);class d extends r.Parser{constructor(){super(...arguments),this.channelIndex=0,this.messageIndex=0}async*parse(e){const t=await e.slice(),s=e.name.toLowerCase().endsWith(".zip")?this.extractTxtFromZip(t):t,a=new TextDecoder("utf-8").decode(s),r=(0,i.parseString)(a);r.sort(((e,t)=>e.date.getTime()-t.date.getTime()));const d=new Set(r.filter((e=>"System"!==e.author)).map((e=>e.author))).size;let h=(0,o.extractChatName)(e.name);h=h||`WhatsApp Chat #${this.channelIndex}`,this.emit("guild",{id:0,name:"WhatsApp Chats"}),this.emit("channel",{id:this.channelIndex,guildId:0,name:h,type:d>2?"group":"dm"});for(const e of r){const t=e.date.getTime(),s=(0,o.removeBadChars)(e.message);if(!(0,o.isGroupWelcome)(s))if(null===e.author);else{this.emit("author",{id:e.author,name:e.author,bot:!1});let a=(0,o.matchAttachmentType)(s);s.includes("https://maps.google.com/?q=")&&(a=n.AttachmentType.Other),this.emit("message",{id:this.messageIndex++,authorId:e.author,channelId:this.channelIndex,timestamp:t,textContent:void 0===a?s:void 0,attachments:void 0===a?[]:[a]})}}this.channelIndex++}extractTxtFromZip(e){if(e.byteLength>314572800)throw new Error("Do not attach media files while exporting (file too big)");const t=(0,a.unzipSync)(new Uint8Array(e)),s=Object.keys(t);if(s.includes("_chat.txt"))return t["_chat.txt"];{const e=s.filter((e=>e.match(/.*(?:chat|whatsapp).*\.txt$/i))).sort(((e,t)=>e.length-t.length));if(e.length>0)return t[e[0]]}throw new Error("Could not find txt file in zip")}}t.WhatsAppParser=d},692:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BigMap=void 0;const s=Math.pow(2,24)-1;t.BigMap=class{constructor(){this.maps=[new Map]}get lastMap(){return this.maps[this.maps.length-1]}set(e,t){this.lastMap.size>=s&&this.maps.push(new Map),this.lastMap.set(e,t)}get(e){for(let t=this.maps.length-1;t>=0;t--){const s=this.maps[t].get(e);if(void 0!==s)return s}}}},3433:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessagesInterval=t.ChannelMessages=void 0;const a=s(7934),i=s(7042);t.ChannelMessages=class{constructor(){this.intervals=[]}addMessage(e){for(const t of this.intervals)if(t!==this.openInterval&&t.isContained(e.timestamp))return;this.openInterval?this.openInterval.addMessageAndExtend(e):(this.openInterval=new n(e),this.intervals.push(this.openInterval),this.intervals.sort(((e,t)=>e.startTimestamp-t.startTimestamp)))}markEOF(){this.openInterval=void 0}process(e){for(const t of this.intervals)t.process(e,t!==this.openInterval)}*processedMessages(){for(const e of this.intervals)yield*e.processedMessages()}get numMessages(){return this.intervals.reduce(((e,t)=>e+t.numMessages),0)}};class n{constructor(e){this.messageQueue=[],this.messages=new i.MessagesArray(a.DefaultMessageBitConfig),this.ids=[],this.start=e.timestamp,this.end=e.timestamp,this.addMessageAndExtend(e)}addMessageAndExtend(e){if(e.timestamp<this.end)throw new Error("MessagesInterval can only be extended to the future");this.messageQueue.push(e),this.ids.push(e.id),this.end=e.timestamp}process(e,t){if(0===this.messageQueue.length)return;const s=this.messageQueue.length;let a=this.messageQueue[0].authorId,i=0,n=1;for(;n<s;){const t=this.messageQueue[n].authorId;if(t!==a){const s=this.messageQueue.slice(i,n);for(const t of e(s))this.messages.push(t);a=t,i=n}n++}if(t){const t=this.messageQueue.slice(i,s);for(const s of e(t))this.messages.push(s);this.messageQueue=[]}else this.messageQueue=this.messageQueue.slice(i,s)}*processedMessages(){let e=0;for(const t of this.messages)yield{id:this.ids[e++],msg:t}}isContained(e){return this.start<=e&&e<=this.end}get startTimestamp(){return this.start}get numMessages(){return this.messageQueue.length+this.messages.length}}t.MessagesInterval=n},3230:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseBuilder=void 0;const a=s(4451),i=s(1739),n=s(7040),r=s(692),o=s(3433),d=s(5866),h=s(8093),l=s(6070),c=s(1048),m=s(6610),u=s(7042);t.DatabaseBuilder=class{get numChannels(){return this.channels.size}get numAuthors(){return this.authors.size}get numMessages(){return[...this.messagesInChannel.values()].reduce(((e,t)=>e+t.numMessages),0)}constructor(e,t){this.config=e,this.env=t,this.guilds=new h.IndexedMap,this.channels=new h.IndexedMap,this.authors=new h.IndexedMap,this.words=new h.IndexedMap,this.emojis=new h.IndexedMap,this.mentions=new h.IndexedMap,this.domains=new h.IndexedMap,this.replyIds=[],this.messagesInChannel=new Map,this.messageProcessor=new l.MessageProcessor(this),this.minDate=i.Day.HIGHEST,this.maxDate=i.Day.LOWEST,this.guildCounts=[],this.channelCounts=[],this.authorCounts=[],this.wordsCounts=[],this.langCounts=[],this.guildsRank=[],this.channelsRank=[],this.authorsRank=[],this.wordsRank=[],this.dmParticipants=new Map,this.parser=(0,n.createParser)(e.platform),this.parser.on("guild",((e,t)=>this.guilds.set(e.id,e,t))),this.parser.on("channel",((e,t)=>this.channels.set(e.id,e,t))),this.parser.on("author",((e,t)=>this.authors.set(e.id,e,t))),this.parser.on("message",((e,t)=>{let s=this.messagesInChannel.get(e.channelId);void 0===s&&(s=new o.ChannelMessages,this.messagesInChannel.set(e.channelId,s)),s.addMessage(e)}))}async init(){await this.messageProcessor.init(this.env),this.stopwords=await m.Stopwords.load(this.env)}async processFiles(e){let t=0;this.env.progress?.stat("total_files",e.length);for(const s of e)this.env.progress?.new("Processing",s.name),await this.processFile(s),this.env.progress?.success(),this.env.progress?.stat("processed_files",++t)}async processFile(e){try{for await(const t of this.parser.parse(e,this.env.progress))this.processPendingMessages()}catch(t){if(t instanceof Error){const s=new Error(`Error parsing file "${e.name}":\n\n${t.message}`);throw s.stack=t.stack,s}throw t}this.markEOF(),this.processPendingMessages()}processPendingMessages(){for(const e of this.messagesInChannel.values())e.process((e=>{const t=this.messageProcessor.processGroupToIntermediate(e);for(let s=0;s<t.length;s++)this.postProcessMessage(e[s],t[s]);return t}));this.env.progress?.stat("channels",this.numChannels),this.env.progress?.stat("authors",this.numAuthors),this.env.progress?.stat("messages",this.numMessages)}markEOF(){for(const e of this.messagesInChannel.values())e.markEOF()}postProcessMessage(e,t){const s=this.channels.getIndex(e.channelId),a=this.channels.getByIndex(s),n=this.guilds.getIndex(a.guildId);if(this.guildCounts[n]=(this.guildCounts[n]||0)+1,this.channelCounts[s]=(this.channelCounts[s]||0)+1,this.authorCounts[t.authorIndex]=(this.authorCounts[t.authorIndex]||0)+1,t.words)for(const[e,s]of t.words)this.wordsCounts[e]=(this.wordsCounts[e]||0)+s;if(void 0!==t.langIndex&&(this.langCounts[t.langIndex]=(this.langCounts[t.langIndex]||0)+1),"dm"===a.type){this.dmParticipants.has(a.id)||this.dmParticipants.set(a.id,[]);const e=this.dmParticipants.get(a.id);e.includes(t.authorIndex)||e.push(t.authorIndex)}const r=i.Day.fromBinary(t.dayIndex);i.Day.lt(r,this.minDate)&&(this.minDate=r),i.Day.gt(r,this.maxDate)&&(this.maxDate=r)}detectLanguages(){const e=this.langCounts.reduce(((e,t)=>e+t),0);return this.langCounts.map(((t,s)=>({code:a.LanguageCodes[s],ratio:t/e}))).filter((e=>e.ratio>=.03)).sort(((e,t)=>t.ratio-e.ratio)).map((e=>e.code))}filterWords(e){this.env.progress?.new("Filtering words...");const t=this.wordsCounts.length;for(let s=0;s<t;s++){let a=!1;this.wordsCounts[s]<=1&&t>1e5&&(a=!0),this.stopwords.isStopword(this.words.getByIndex(s),e)&&(a=!0),a&&(this.wordsCounts[s]=-1),this.env.progress?.progress("number",s,t)}this.env.progress?.success()}countAndReindex(){this.env.progress?.new("Computing new indexes..."),this.guildsRank=(0,c.rank)(this.guildCounts),this.channelsRank=(0,c.rank)(this.channelCounts),this.authorsRank=(0,c.rank)(this.authorCounts),this.wordsRank=(0,c.rank)(this.wordsCounts),this.env.progress?.success()}makeFinalObjects(){this.env.progress?.new("Building final objects...");const e=(0,c.remap)(this.makeFinalGuild.bind(this),this.guilds.values,this.guildsRank,this.env.progress),t=(0,c.remap)(this.makeFinalChannel.bind(this),this.channels.values,this.channelsRank,this.env.progress),s=(0,c.remap)(this.makeFinalAuthor.bind(this),this.authors.values,this.authorsRank,this.env.progress),a=(0,c.remap)((e=>e),this.words.values,this.wordsRank,this.env.progress);return this.env.progress?.success(),{guilds:e,channels:t,authors:s,words:a}}makeFinalGuild(e){return{name:e.name,avatar:e.avatar}}makeFinalChannel(e){const t=this.dmParticipants.get(e.id)||[];return{name:"dm"!==e.type?e.name:t.map((e=>{const t=this.authors.getByIndex(e).name;return 4===t.split("#").pop()?.length?t.slice(0,-5):t})).join(" & "),type:e.type,avatar:e.avatar,guildIndex:this.guildsRank[this.guilds.getIndex(e.guildId)],participants:t.length>0?t:void 0,msgAddr:void 0,msgCount:void 0}}makeFinalAuthor(e,t){return{i:e.id,n:e.name,b:!0===e.bot||void 0,a:this.authorsRank[t]<1e3?e.avatar:void 0}}compactMessagesData(e,t){this.env.progress?.new("Compacting messages data");const s=e=>Math.max(1,0===e?1:32-Math.clz32(e)),a={dayBits:s(t.length),authorIdxBits:s(this.authors.size),wordIdxBits:s(this.words.size),emojiIdxBits:s(this.emojis.size),mentionsIdxBits:s(this.mentions.size),domainsIdxBits:s(this.domains.size)},n=new u.MessagesArray(a),o=new r.BigMap,h=this.numMessages;let l=0;for(const[s,a]of this.messagesInChannel){const r=e[this.channelsRank[this.channels.getIndex(s)]];r.msgAddr=n.byteLength,r.msgCount=a.numMessages;for(const{id:e,msg:s}of a.processedMessages()){if(s.dayIndex=t.indexOf(i.Day.fromBinary(s.dayIndex).dateKey),s.authorIndex=this.authorsRank[s.authorIndex],s.words){const e=new d.IndexCountsBuilder;for(const[t,a]of s.words){const s=this.wordsRank[t];s>=0&&e.incr(s,a)}s.words=e.toArray(),0===s.words.length&&delete s.words}if(o.set(e,n.byteLength),void 0!==s.replyOffset){const e=this.replyIds[s.replyOffset],t=o.get(e);void 0!==e&&void 0!==t&&(s.replyOffset=t)}n.push(s),this.env.progress?.progress("number",++l,h)}}return this.env.progress?.success(),{finalMessages:n}}build(){if(0===this.numMessages)throw new Error("No messages found. Are you sure you are using the right platform?");const e=this.detectLanguages();this.filterWords(e),this.countAndReindex();const{guilds:t,channels:s,authors:a,words:n}=this.makeFinalObjects(),{dateKeys:r,monthKeys:o,yearKeys:d}=(0,i.genTimeKeys)(this.minDate,this.maxDate),{finalMessages:h}=this.compactMessagesData(s,r);return{config:this.config,generatedAt:(new Date).toISOString(),title:this.buildTitle(t,s),langs:e,time:{minDate:this.minDate.dateKey,maxDate:this.maxDate.dateKey,numDays:r.length,numMonths:o.length,numYears:d.length},guilds:t,channels:s,authors:a,words:n,emojis:this.emojis.values,mentions:this.mentions.values,domains:this.domains.values,messages:h.stream.buffer8,numMessages:h.length,bitConfig:h.bitConfig}}buildTitle(e,t){if("discord"!==this.config.platform)return 1===t.length?t[0].name:e[0].name;if(e.length>1)return e.some((e=>"Direct Messages"===e.name))?"Discord Servers and DMs":"Discord Servers";const s=e[0];return"Direct Messages"!==s.name?s.name:1===t.length?t[0].name:t.every((e=>"dm"===e.type))?"Discord DMs":t.every((e=>"group"===e.type))?"Discord Groups":"Discord Chats"}}},5866:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IndexCountsBuilder=void 0;class s{constructor(){this.data={}}incr(e,t=1){this.data[e]=(this.data[e]||0)+t}toArray(){return Object.entries(this.data).sort((([e,t],[s,a])=>a-t)).map((([e,t])=>[parseInt(e),t]))}static fromList(e){const t=new s;for(const s of e)t.incr(s);return t}}t.IndexCountsBuilder=s},8093:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedMap=void 0,t.IndexedMap=class{constructor(){this.index=new Map,this.array=[]}set(e,t,s=Number.MIN_SAFE_INTEGER){let a=this.index.get(e);return void 0===a?(a={revision:s||Number.MIN_SAFE_INTEGER,index:this.array.length},this.index.set(e,a),this.array[a.index]=t):s>a.revision&&(a.revision=s,this.array[a.index]=t),a.index}getIndex(e){return this.index.get(e)?.index}getByIndex(e){return this.array[e]}get values(){return this.array}get size(){return this.array.length}}},6070:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageProcessor=void 0;const a=s(1739),i=s(5866),n=s(6096),r=s(5977),o=s(9882),d=s(5932),h=s(1346);t.MessageProcessor=class{constructor(e){this.builder=e}async init(e){this.emojis=await n.Emojis.load(e),this.langPredictModel=await r.FastTextLID176Model.load(e),this.sentiment=await o.Sentiment.load(e,this.emojis)}processGroupToIntermediate(e){const t=e.map((e=>e.textContent?(0,h.tokenize)((0,d.normalizeText)(e.textContent)):[])),s=t.flat().filter((e=>"word"===e.tag)).map((e=>e.text)).join(" ").toLowerCase();let a;return s.length>0&&(a=this.langPredictModel.identifyLanguage(s).iso639index),e.map(((e,s)=>this.processMessage(e,t[s],a)))}processMessage(e,t,s){const n=new i.IndexCountsBuilder,r=new i.IndexCountsBuilder,o=new i.IndexCountsBuilder,h=new i.IndexCountsBuilder,l=new i.IndexCountsBuilder;if(e.reactions)for(const[t,s]of e.reactions){const e=(0,d.normalizeText)(t.text);h.incr(this.processEmoji(void 0===t.id?{type:"unicode",symbol:e,name:this.emojis.getName(e)}:{type:"custom",id:t.id,name:t.text}),s)}for(const{tag:e,text:s}of t)switch(e){case"word":const e=this.processWord(s);void 0!==e&&n.incr(e);break;case"emoji":const t=(0,d.normalizeText)(s);r.incr(this.processEmoji({type:"unicode",symbol:t,name:this.emojis.getName(t)}));break;case"custom-emoji":r.incr(this.processEmoji({type:"custom",name:s}));break;case"mention":o.incr(this.processMention(s));break;case"url":const a=this.processURL(s);void 0!==a&&l.incr(a)}let c,m=0;s&&(m=this.sentiment?.calculate(t,s)||0),e.replyTo&&(c=this.builder.replyIds.length,this.builder.replyIds.push(e.replyTo));const u=new Date(e.timestamp),p=a.Day.fromDate(u);let g;return void 0!==e.timestampEdit&&(g=Math.ceil((new Date(e.timestampEdit).getTime()-u.getTime())/1e3)),{dayIndex:p.toBinary(),secondOfDay:u.getSeconds()+60*(u.getMinutes()+60*u.getHours()),editedAfter:g,authorIndex:this.builder.authors.getIndex(e.authorId),replyOffset:c,langIndex:s,sentiment:void 0!==s?m:void 0,words:n.toArray(),emojis:r.toArray(),mentions:o.toArray(),reactions:h.toArray(),domains:l.toArray(),attachments:i.IndexCountsBuilder.fromList(e.attachments??[]).toArray()}}forceStringCopy(e){return(" "+e).slice(1)}processWord(e){const{words:t}=this.builder,s=(0,d.matchFormat)(e);if(e.length>1&&e.length<=30){let a=t.getIndex(s);return void 0===a&&(a=t.set(s,this.forceStringCopy(e))),a}}processEmoji(e){const{emojis:t}=this.builder,s=(0,d.normalizeText)(e.name).toLowerCase();let a=t.getIndex(s);if(void 0===a)a=t.set(s,e);else{const i=t.getByIndex(a);"custom"===i.type&&"custom"===e.type&&void 0===i.id&&void 0!==e.id&&t.set(s,e,999)}return a}processMention(e){const{mentions:t}=this.builder,s=(0,d.matchFormat)(e);let a=t.getIndex(s);return void 0===a&&(a=t.set(s,this.forceStringCopy(e))),a}processURL(e){const{domains:t}=this.builder;try{const s=new URL(e).hostname.toLowerCase();let a=t.getIndex(s);return void 0===a&&(a=t.set(s,s)),a}catch(e){return}}}},1048:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.remap=t.rank=void 0,t.rank=e=>{const t=new Array(e.length).fill(0).map(((t,s)=>[s,e[s]])).sort(((e,t)=>t[1]-e[1])),s=new Array(e.length).fill(-1);let a=0,i=0;for(;a<t.length;){const[e,n]=t[a];n>=0&&(s[e]=i++),a++}return s},t.remap=(e,t,s,a)=>{const i=new Array(t.length).fill(void 0);for(let n=0;n<t.length;n++){const r=s[n];r>=0&&(i[r]=e(t[n],n)),a?.progress("number",n,t.length)}return i.filter((e=>void 0!==e))}},6096:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Emojis=void 0;class s{constructor(e){this.data=e}getName(e){return this.data[e]?this.data[e].n:e}getSentiment(e){return this.data[e]?.s||0}static async load(e){return new s(await e.loadAsset("/data/emojis/emoji-data.json","json"))}}t.Emojis=s},5977:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FastTextLID176Model=t.FastTextModel=void 0;const a=s(4451);class i{constructor(e){this.model=e}predict(e,t=1,s=0){const a=this.model.predict(e,t,s),i=a.size(),n=[];for(let e=0;e<i;e++)n.push(a.get(e));return n}static async load(e,t){const s=await t.loadAsset("/fasttext/fasttext_wasm.js","text"),a=await t.loadAsset("/fasttext/fasttext_wasm.wasm","arraybuffer"),n=new Uint8Array(await t.loadAsset(e,"arraybuffer")),r=new Function(s+"; return Module;")(),o=await r({wasmBinary:a}),{FS:d}=o,h=d.open("model.bin","w+");d.write(h,n,0,n.length,0),d.close(h);const l=new o.FastText;return l.loadModel("model.bin"),new i(l)}}t.FastTextModel=i;class n{constructor(e){this.model=e}identifyLanguage(e){const t=this.model.predict(e,1,0),s=t[0][1].slice(9);return{iso639:s,iso639index:(0,a.getLanguageIndexByCode)(s),accuracy:t[0][0]}}static async load(e){return new n(await i.load("/data/models/lid.176.ftz",e))}}t.FastTextLID176Model=n},9882:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Sentiment=void 0;const a=s(4419),i=s(4451),n=s(5932),r=s(1346);class o{constructor(e,t,s){this.emojiData=t,this.langs={};const n=(0,a.unzipSync)(new Uint8Array(e)),r={};for(const e in n)r[e]=new TextDecoder("utf-8").decode(n[e]);const o=JSON.parse(r["all-negators.json"]);s?.new("Preparing sentiment database");const h=Object.keys(r).length;let l=0;for(const e in r){if(e.startsWith("AFINN-")){const t=e.substring(6,e.length-5),s=i.LanguageCodes.indexOf(t);if(-1===s)continue;const a=o[t],n=JSON.parse(r[e]);this.langs[s]={negators:new d(a),afinn:new d(Object.keys(n),Object.values(n))}}s?.progress("number",l++,h)}s?.success()}calculate(e,t){const s=this.langs[t];if(void 0===s)return;let a=0,i=!1,n=0;for(let t=0,r=e.length;t<r;t++){const r=e[t];if(("word"!==r.tag||n>5)&&(i=!1),n++,"emoji"!==r.tag){if("word"==r.tag){const r=e.slice(t);if(s.negators.match(r)){i=!0,n=0;continue}const o=s.afinn.match(r);o&&(a+=o.value*(i?-1:1))}}else a+=this.emojiData.getSentiment(r.text)}return a}static async load(e,t){const s=await e.loadAsset("/data/text/AFINN.zip","arraybuffer");return new o(s,t,e.progress)}}t.Sentiment=o;class d{constructor(e,t){t&&console.assert(e.length===t.length);const s=e.length,a=(e=e.map((e=>(0,n.normalizeText)(e).toLowerCase()))).map((e=>(0,r.tokenize)(e))).map((e=>e.filter((e=>"word"===e.tag||"emoji"===e.tag)).map((e=>e.text))));this.mapping=new Map;for(let e=0;e<s;e++){const s=a[e];if(0===s.length)continue;const i={value:t?t[e]:1,pattern:s.slice(1)};this.mapping.has(s[0])?this.mapping.get(s[0]).push(i):this.mapping.set(s[0],[i])}for(const e of this.mapping.keys()){const t=this.mapping.get(e);t?.sort(((e,t)=>t.pattern.length-e.pattern.length))}}match(e){if(0===e.length)return;const t=this.mapping.get(e[0].text);if(void 0!==t)for(const s of t){const t=s.pattern.length;if(e.length-1<t)continue;let a=0;for(;a<t&&"word"===e[a+1].tag&&e[a+1].text.toLowerCase()===s.pattern[a];)a++;if(a===t)return s}}}},6610:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Stopwords=void 0;const a=s(5932);class i{constructor(e){this.stopwords=e;for(const t in e)e[t]=e[t].map((e=>(0,a.matchFormat)(e)))}isStopword(e,t){const s=(0,a.matchFormat)(e);for(const e of t)if(this.stopwords[e]&&this.stopwords[e].includes(s))return!0;return!1}static async load(e){return new i(await e.loadAsset("/data/text/stopwords-iso.json","json"))}}t.Stopwords=i},5932:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.matchFormat=t.stripDiacriticsAndSymbols=t.normalizeText=void 0;const s=/\s\s+/g,a=/[\u{FE0F}\u{FE0E}]/gu;t.normalizeText=e=>e.normalize("NFKC").replace(s," ").replace(a,"").trim();const i=[{base:"A",letters:"Aâ’¶ï¼¡Ã€ÃÃ‚áº¦áº¤áºªáº¨ÃƒÄ€Ä‚áº°áº®áº´áº²È¦Ç Ã„Çáº¢Ã…ÇºÇÈ€È‚áº áº¬áº¶á¸€Ä„Èºâ±¯ğ€"},{base:"AA",letters:"êœ²"},{base:"AE",letters:"Ã†Ç¼Ç¢"},{base:"AO",letters:"êœ´"},{base:"AU",letters:"êœ¶"},{base:"AV",letters:"êœ¸êœº"},{base:"AY",letters:"êœ¼"},{base:"B",letters:"Bâ’·ï¼¢á¸‚á¸„á¸†ÉƒÆ‚Æğ"},{base:"C",letters:"Câ’¸ï¼£Ä†ÄˆÄŠÄŒÃ‡á¸ˆÆ‡È»êœ¾ğ‚"},{base:"D",letters:"Dâ’¹ï¼¤á¸ŠÄá¸Œá¸á¸’á¸ÄÆ‹ÆŠÆ‰ê¹ğƒ"},{base:"DZ",letters:"Ç±Ç„"},{base:"Dz",letters:"Ç²Ç…"},{base:"E",letters:"Eâ’ºï¼¥ÃˆÃ‰ÃŠá»€áº¾á»„á»‚áº¼Ä’á¸”á¸–Ä”Ä–Ã‹áººÄšÈ„È†áº¸á»†È¨á¸œÄ˜á¸˜á¸šÆÆğ„"},{base:"F",letters:"Fâ’»ï¼¦á¸Æ‘ê»ğ…"},{base:"G",letters:"Gâ’¼ï¼§Ç´Äœá¸ ÄÄ Ç¦Ä¢Ç¤Æ“ê ê½ê¾ğ†"},{base:"H",letters:"Hâ’½ï¼¨Ä¤á¸¢á¸¦Èá¸¤á¸¨á¸ªÄ¦â±§â±µêğ‡"},{base:"I",letters:"Iâ’¾ï¼©ÃŒÃÃÄ¨ÄªÄ¬Ä°Ãá¸®á»ˆÇÈˆÈŠá»ŠÄ®á¸¬Æ—ğˆ"},{base:"J",letters:"Jâ’¿ï¼ªÄ´Éˆğ‰"},{base:"K",letters:"Kâ“€ï¼«á¸°Ç¨á¸²Ä¶á¸´Æ˜â±©ê€ê‚ê„ê¢ğŠ"},{base:"L",letters:"Lâ“ï¼¬Ä¿Ä¹Ä½á¸¶á¸¸Ä»á¸¼á¸ºÅÈ½â±¢â± êˆê†ê€ğ‹"},{base:"LJ",letters:"Ç‡"},{base:"Lj",letters:"Çˆ"},{base:"M",letters:"Mâ“‚ï¼­á¸¾á¹€á¹‚â±®ÆœğŒ"},{base:"N",letters:"Nâ“ƒï¼®Ç¸ÅƒÃ‘á¹„Å‡á¹†Å…á¹Šá¹ˆÈ Æêê¤ğ"},{base:"NJ",letters:"ÇŠ"},{base:"Nj",letters:"Ç‹"},{base:"O",letters:"Oâ“„ï¼¯Ã’Ã“Ã”á»’á»á»–á»”Ã•á¹ŒÈ¬á¹ÅŒá¹á¹’ÅÈ®È°Ã–Èªá»ÅÇ‘ÈŒÈÆ á»œá»šá» á»á»¢á»Œá»˜ÇªÇ¬Ã˜Ç¾Æ†ÆŸêŠêŒğ"},{base:"OI",letters:"Æ¢"},{base:"OO",letters:"ê"},{base:"OU",letters:"È¢"},{base:"P",letters:"Pâ“…ï¼°á¹”á¹–Æ¤â±£êê’ê”ğ"},{base:"Q",letters:"Qâ“†ï¼±ê–ê˜ÉŠğ"},{base:"R",letters:"Râ“‡ï¼²Å”á¹˜Å˜ÈÈ’á¹šá¹œÅ–á¹ÉŒâ±¤êšê¦ê‚ğ‘"},{base:"S",letters:"Sâ“ˆï¼³áºÅšá¹¤Åœá¹ Å á¹¦á¹¢á¹¨È˜Åâ±¾ê¨ê„ğ’"},{base:"T",letters:"Tâ“‰ï¼´á¹ªÅ¤á¹¬ÈšÅ¢á¹°á¹®Å¦Æ¬Æ®È¾ê†ğ“"},{base:"TZ",letters:"êœ¨"},{base:"U",letters:"Uâ“Šï¼µÃ™ÃšÃ›Å¨á¹¸Åªá¹ºÅ¬ÃœÇ›Ç—Ç•Ç™á»¦Å®Å°Ç“È”È–Æ¯á»ªá»¨á»®á»¬á»°á»¤á¹²Å²á¹¶á¹´É„ğ”"},{base:"V",letters:"Vâ“‹ï¼¶á¹¼á¹¾Æ²êÉ…ğ•"},{base:"VY",letters:"ê "},{base:"W",letters:"Wâ“Œï¼·áº€áº‚Å´áº†áº„áºˆâ±²ğ–"},{base:"X",letters:"Xâ“ï¼¸áºŠáºŒğ—"},{base:"Y",letters:"Yâ“ï¼¹á»²ÃÅ¶á»¸È²áºÅ¸á»¶á»´Æ³Éá»¾ğ˜"},{base:"Z",letters:"Zâ“ï¼ºÅ¹áºÅ»Å½áº’áº”ÆµÈ¤â±¿â±«ê¢ğ™"},{base:"a",letters:"aâ“ï½áºšÃ Ã¡Ã¢áº§áº¥áº«áº©Ã£ÄÄƒáº±áº¯áºµáº³È§Ç¡Ã¤ÇŸáº£Ã¥Ç»ÇÈÈƒáº¡áº­áº·á¸Ä…â±¥Éğš"},{base:"aa",letters:"êœ³"},{base:"ae",letters:"Ã¦Ç½Ç£"},{base:"ao",letters:"êœµ"},{base:"au",letters:"êœ·"},{base:"av",letters:"êœ¹êœ»"},{base:"ay",letters:"êœ½"},{base:"b",letters:"bâ“‘ï½‚á¸ƒá¸…á¸‡Æ€ÆƒÉ“ğ›"},{base:"c",letters:"câ“’ï½ƒÄ‡Ä‰Ä‹ÄÃ§á¸‰ÆˆÈ¼êœ¿â†„ğœ"},{base:"d",letters:"dâ““ï½„á¸‹Äá¸á¸‘á¸“á¸Ä‘ÆŒÉ–É—êºğ"},{base:"dz",letters:"Ç³Ç†"},{base:"e",letters:"eâ“”ï½…Ã¨Ã©Ãªá»áº¿á»…á»ƒáº½Ä“á¸•á¸—Ä•Ä—Ã«áº»Ä›È…È‡áº¹á»‡È©á¸Ä™á¸™á¸›É‡É›Çğ"},{base:"f",letters:"fâ“•ï½†á¸ŸÆ’ê¼ğŸ"},{base:"g",letters:"gâ“–ï½‡ÇµÄá¸¡ÄŸÄ¡Ç§Ä£Ç¥É ê¡áµ¹ê¿ğ "},{base:"h",letters:"hâ“—ï½ˆÄ¥á¸£á¸§ÈŸá¸¥á¸©á¸«áº–Ä§â±¨â±¶É¥ğ¡"},{base:"hv",letters:"Æ•"},{base:"i",letters:"iâ“˜ï½‰Ã¬Ã­Ã®Ä©Ä«Ä­Ã¯á¸¯á»‰ÇÈ‰È‹á»‹Ä¯á¸­É¨Ä±ğ¢"},{base:"j",letters:"jâ“™ï½ŠÄµÇ°É‰ğ£"},{base:"k",letters:"kâ“šï½‹á¸±Ç©á¸³Ä·á¸µÆ™â±ªêêƒê…ê£ğ¤"},{base:"l",letters:"lâ“›ï½ŒÅ€ÄºÄ¾á¸·á¸¹Ä¼á¸½á¸»Å¿Å‚ÆšÉ«â±¡ê‰êê‡ğ¥"},{base:"lj",letters:"Ç‰"},{base:"m",letters:"mâ“œï½á¸¿á¹á¹ƒÉ±É¯ğ¦"},{base:"n",letters:"nâ“ï½Ç¹Å„Ã±á¹…Åˆá¹‡Å†á¹‹á¹‰ÆÉ²Å‰ê‘ê¥ğ§"},{base:"nj",letters:"ÇŒ"},{base:"o",letters:"oâ“ï½Ã²Ã³Ã´á»“á»‘á»—á»•Ãµá¹È­á¹Åá¹‘á¹“ÅÈ¯È±Ã¶È«á»Å‘Ç’ÈÈÆ¡á»á»›á»¡á»Ÿá»£á»á»™Ç«Ç­Ã¸Ç¿É”ê‹êÉµğ¨"},{base:"oi",letters:"Æ£"},{base:"ou",letters:"È£"},{base:"oo",letters:"ê"},{base:"p",letters:"pâ“Ÿï½á¹•á¹—Æ¥áµ½ê‘ê“ê•ğ©"},{base:"q",letters:"qâ“ ï½‘É‹ê—ê™ğª"},{base:"r",letters:"râ“¡ï½’Å•á¹™Å™È‘È“á¹›á¹Å—á¹ŸÉÉ½ê›ê§êƒğ«"},{base:"s",letters:"sâ“¢ï½“ÃŸÅ›á¹¥Åá¹¡Å¡á¹§á¹£á¹©È™ÅŸÈ¿ê©ê…áº›ğ¬"},{base:"t",letters:"tâ“£ï½”á¹«áº—Å¥á¹­È›Å£á¹±á¹¯Å§Æ­Êˆâ±¦ê‡ğ­"},{base:"tz",letters:"êœ©"},{base:"u",letters:"uâ“¤ï½•Ã¹ÃºÃ»Å©á¹¹Å«á¹»Å­Ã¼ÇœÇ˜Ç–Çšá»§Å¯Å±Ç”È•È—Æ°á»«á»©á»¯á»­á»±á»¥á¹³Å³á¹·á¹µÊ‰ğ®"},{base:"v",letters:"vâ“¥ï½–á¹½á¹¿Ê‹êŸÊŒğ¯"},{base:"vy",letters:"ê¡"},{base:"w",letters:"wâ“¦ï½—áºáºƒÅµáº‡áº…áº˜áº‰â±³ğ°"},{base:"x",letters:"xâ“§ï½˜áº‹áºğ±"},{base:"y",letters:"yâ“¨ï½™á»³Ã½Å·á»¹È³áºÃ¿á»·áº™á»µÆ´Éá»¿ğ²"},{base:"z",letters:"zâ“©ï½šÅºáº‘Å¼Å¾áº“áº•Æ¶È¥É€â±¬ê£ğ³"}],n=new RegExp("["+i.map((e=>e.letters)).join("")+"]","gu"),r={};for(const e of i)for(const t of e.letters)r[t]=e.base;t.stripDiacriticsAndSymbols=e=>e.replace(n,(e=>r[e])),t.matchFormat=e=>(0,t.stripDiacriticsAndSymbols)((0,t.normalizeText)(e)).toLocaleLowerCase()},1346:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.tokenize=t.tokenizeStep=t.splitByToken=void 0;const i=[{regex:/```[^`]*```/g,tag:"code"},{regex:/https?:\/\/[^\s<]+[^<.,:;"')\]\s]/g,tag:"url"},{regex:/@[\p{L}_0-9]+/giu,tag:"mention",transform:e=>e.slice(1)},{regex:(0,a(s(631)).default)(),tag:"emoji"},{regex:/:\w+:/gi,tag:"custom-emoji",transform:e=>e.slice(1,-1)},{regex:/(?:\p{L}[\p{L}'0-9-]*[\p{L}0-9])|\p{L}/giu,tag:"word"}];t.splitByToken=(e,t)=>{const s=[],a=e.match(t.regex),i=e.split(t.regex);for(let e=0;e<i.length;e++){const n=i[e].trim();n.length>0&&s.push(n),a&&e<a.length&&s.push({text:t.transform?t.transform(a[e]):a[e],tag:t.tag})}return s},t.tokenizeStep=(e,s)=>{if(s>=i.length)return[{text:e,tag:"unknown"}];const a=[],n=(0,t.splitByToken)(e,i[s]);for(const e of n)"string"==typeof e?a.push(...(0,t.tokenizeStep)(e,s+1)):a.push(e);return a},t.tokenize=e=>(0,t.tokenizeStep)(e,0)},776:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BitStream=void 0,t.BitStream=class{constructor(e){if(e){if(ArrayBuffer.isView(e))throw new Error("buffer must not be a view");if(e.byteLength%4!=0)throw new Error("buffer must be aligned to 32bits")}this.buffer=e?new Uint32Array(e):new Uint32Array(1024),this.offset=0}get buffer8(){return new Uint8Array(this.buffer.buffer,0,4*Math.ceil(this.offset/32))}grow(){const e=new Uint32Array(1.5*this.buffer.length);e.set(this.buffer),this.buffer=e}setBits(e,t){const s=this.offset;this.offset+=e,(s+e)/8>this.buffer.byteLength-4&&this.grow();const a=this.buffer,i=32===e?4294967295:(1<<e)-1,n=t&i,r=Math.floor(s/32),o=s-32*r;if(o+e>32){const t=e-(32-o);a[r]=a[r]&~(i>>>t)|n>>>t,a[r+1]=a[r+1]&~(i<<32-t)|n<<32-t}else{const t=32-o-e;a[r]=a[r]&~(i<<t)|n<<t}}getBits(e){const t=this.buffer,s=this.offset;this.offset+=e;const a=Math.floor(s/32),i=s-32*a,n=t[a],r=t[a+1];let o=0;return o=i+e>32?(n<<i|r>>>32-i)>>>32-e:n<<i>>>32-e,o>>>0}writeVarInt(e,t=32){if(t<10)this.setBits(t,e);else if(t>30){let t=BigInt(e);for(;t>127n;)this.setBits(8,Number(127n&t|128n)),t>>=7n;this.setBits(8,Number(t))}else{for(;e>127;)this.setBits(8,127&e|128),e>>>=7;this.setBits(8,e)}}readVarInt(e=32){if(e<10)return this.getBits(e);if(e>30){let e=0n,t=0n,s=0n;do{t=BigInt(this.getBits(8)),e|=(127n&t)<<s,s+=7n}while(128n&t);return Number(e)}{let e=0,t=0,s=0;do{t=this.getBits(8),e|=(127&t)<<s,s+=7}while(128&t);return e}}}},9523:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.skipIndexCounts=t.readIndexCounts=t.writeIndexCounts=void 0,t.writeIndexCounts=(e,t,s)=>{const a=e.length;let i=0,n=0;for(let t=0;t<a;t++){const s=e[t][1];i+=s,n=Math.max(n,s)}if(0===a)throw new Error("Cannot write empty IndexCounts");if(0===i)throw new Error("Cannot write IndexCounts with total 0");if(0===n)throw new Error("Cannot write IndexCounts with maxCount 0");if(1===i)return t.setBits(2,0),void t.setBits(s,e[0][0]);if(2===i)return t.setBits(2,1),void(1===e.length?(t.setBits(s,e[0][0]),t.setBits(s,e[0][0])):(t.setBits(s,e[0][0]),t.setBits(s,e[1][0])));const r=32-Math.clz32(n),o=Math.min(i,1023),d=Math.min(a,127);if(10+s*o<12+(s+r)*d){e.sort(((e,t)=>e[0]-t[0])),t.setBits(2,2),t.setBits(10,o);let i=0,n=0;for(let r=0;r<a;r++)for(let a=0;a<e[r][1]&&i<o;a++){const a=e[r][0]-n;t.setBits(s,a),n+=a,i++}}else{t.setBits(2,3),t.setBits(7,d),t.setBits(5,r-1);for(let a=0;a<d;a++)t.setBits(s,e[a][0]),t.setBits(r,e[a][1])}},t.readIndexCounts=(e,t)=>{const s=[],a=e.getBits(2);if(0===a)s.push([e.getBits(t),1]);else if(1===a)s.push([e.getBits(t),1]),s.push([e.getBits(t),1]);else if(2===a){const a=e.getBits(10);let i=-1;for(let n=0;n<a;n++){const a=e.getBits(t);-1===i?(s.push([a,1]),i=a):0===a?s[s.length-1][1]++:(s.push([i+a,1]),i+=a)}}else{const a=e.getBits(7),i=e.getBits(5)+1;for(let n=0;n<a;n++){const a=e.getBits(t),n=e.getBits(i);s.push([a,n])}}return s},t.skipIndexCounts=(e,t)=>{const s=e.getBits(2);if(0===s)e.offset+=t;else if(1===s)e.offset+=2*t;else if(2===s){const s=e.getBits(10);e.offset+=t*s}else{const s=e.getBits(7),a=e.getBits(5)+1;e.offset+=(t+a)*s}}},7934:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.readMessage=t.writeMessage=t.DefaultMessageBitConfig=t.MessageFlags=void 0;const a=s(9523);var i;!function(e){e[e.None=0]="None",e[e.Reply=1]="Reply",e[e.Edited=2]="Edited",e[e.Text=4]="Text",e[e.Words=8]="Words",e[e.Emojis=16]="Emojis",e[e.Attachments=32]="Attachments",e[e.Reactions=64]="Reactions",e[e.Mentions=128]="Mentions",e[e.Domains=256]="Domains"}(i=t.MessageFlags||(t.MessageFlags={})),t.DefaultMessageBitConfig={dayBits:21,authorIdxBits:21,wordIdxBits:21,emojiIdxBits:18,mentionsIdxBits:20,domainsIdxBits:16},t.writeMessage=(e,t,s)=>{t.setBits(s.dayBits,e.dayIndex),t.setBits(17,e.secondOfDay),t.setBits(s.authorIdxBits,e.authorIndex);let n=i.None;void 0!==e.replyOffset&&(n|=i.Reply),void 0!==e.editedAfter&&(n|=i.Edited),void 0!==e.langIndex&&(n|=i.Text),e.words?.length&&(n|=i.Words),e.emojis?.length&&(n|=i.Emojis),e.attachments?.length&&(n|=i.Attachments),e.reactions?.length&&(n|=i.Reactions),e.mentions?.length&&(n|=i.Mentions),e.domains?.length&&(n|=i.Domains),t.setBits(9,n),n&i.Reply&&t.writeVarInt(e.replyOffset,48),n&i.Edited&&t.writeVarInt(e.editedAfter),n&i.Text&&(t.setBits(8,e.langIndex),t.setBits(8,Math.max(-128,Math.min(127,e.sentiment))+128)),n&i.Words&&(0,a.writeIndexCounts)(e.words,t,s.wordIdxBits),n&i.Emojis&&(0,a.writeIndexCounts)(e.emojis,t,s.emojiIdxBits),n&i.Attachments&&(0,a.writeIndexCounts)(e.attachments,t,3),n&i.Reactions&&(0,a.writeIndexCounts)(e.reactions,t,s.emojiIdxBits),n&i.Mentions&&(0,a.writeIndexCounts)(e.mentions,t,s.mentionsIdxBits),n&i.Domains&&(0,a.writeIndexCounts)(e.domains,t,s.domainsIdxBits)},t.readMessage=(e,t)=>{const s=e.getBits(t.dayBits),n=e.getBits(17),r=e.getBits(t.authorIdxBits),o=e.getBits(9),d={dayIndex:s,secondOfDay:n,authorIndex:r};return o&i.Reply&&(d.replyOffset=e.readVarInt()),o&i.Edited&&(d.editedAfter=e.readVarInt()),o&i.Text&&(d.langIndex=e.getBits(8),d.sentiment=e.getBits(8)-128),o&i.Words&&(d.words=(0,a.readIndexCounts)(e,t.wordIdxBits)),o&i.Emojis&&(d.emojis=(0,a.readIndexCounts)(e,t.emojiIdxBits)),o&i.Attachments&&(d.attachments=(0,a.readIndexCounts)(e,3)),o&i.Reactions&&(d.reactions=(0,a.readIndexCounts)(e,t.emojiIdxBits)),o&i.Mentions&&(d.mentions=(0,a.readIndexCounts)(e,t.mentionsIdxBits)),o&i.Domains&&(d.domains=(0,a.readIndexCounts)(e,t.domainsIdxBits)),d}},7042:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessagesArray=void 0;const a=s(776),i=s(7934);class n{constructor(e,t,s){if(this.bitConfig=e,t){if(void 0===s)throw new Error("Count is required");this.stream=t,this.length=s,this.startOffset=t.offset}else this.stream=new a.BitStream,this.length=0,this.startOffset=0}push(e){(0,i.writeMessage)(e,this.stream,this.bitConfig),this.length++}*[Symbol.iterator](){const e=this.stream.offset;this.stream.offset=this.startOffset;for(let e=0;e<this.length;e++)yield(0,i.readMessage)(this.stream,this.bitConfig);this.stream.offset=e}get byteLength(){return this.stream.offset-this.startOffset}}t.MessagesArray=n}},a={};function i(e){var t=a[e];if(void 0!==t)return t.exports;var n=a[e]={exports:{}};return s[e].call(n.exports,n,n.exports,i),n.exports}i.m=s,i.x=()=>{var e=i.O(void 0,[207],(()=>i(5616)));return i.O(e)},e=[],i.O=(t,s,a,n)=>{if(!s){var r=1/0;for(l=0;l<e.length;l++){for(var[s,a,n]=e[l],o=!0,d=0;d<s.length;d++)(!1&n||r>=n)&&Object.keys(i.O).every((e=>i.O[e](s[d])))?s.splice(d--,1):(o=!1,n<r&&(r=n));if(o){e.splice(l--,1);var h=a();void 0!==h&&(t=h)}}return t}n=n||0;for(var l=e.length;l>0&&e[l-1][2]>n;l--)e[l]=e[l-1];e[l]=[s,a,n]},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,s)=>(i.f[s](e,t),t)),[])),i.u=e=>"assets/"+e+".9aeca9b9.js",i.miniCssF=e=>{},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="/",(()=>{var e={616:1};i.f.i=(t,s)=>{e[t]||importScripts(i.p+i.u(t))};var t=self.webpackChunkchat_analytics=self.webpackChunkchat_analytics||[],s=t.push.bind(t);t.push=t=>{var[a,n,r]=t;for(var o in n)i.o(n,o)&&(i.m[o]=n[o]);for(r&&r(i);a.length;)e[a.pop()]=1;s(t)}})(),t=i.x,i.x=()=>i.e(207).then(t),i.x()})();